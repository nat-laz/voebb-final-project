<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Admin: Products</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.5/dist/zephyr/bootstrap.min.css">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link
            href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.2/mdb.min.css"
            rel="stylesheet"
    />
</head>
<body>
<div class="container my-4">

    <h1 class="h4 mb-3">Products (Admin)</h1>

    <!-- confirm product was created banner  -->
    <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
        <span th:text="${success}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <!-- AddProduct button -->
    <button class="btn btn-primary"
            data-bs-toggle="modal"
            data-bs-target="#addProductModal">
        <i class="bi bi-plus-circle"></i> Add Product
    </button>

    <div th:replace="~{admin/fragments/product-table :: productTable}"></div>

    <!-- modal fragment -->
    <div th:replace="admin/fragments/add-product-modal :: addProductModal"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"></script>
<script
        src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.2/mdb.min.js"
></script>

<!-- Optional: Manually init the select if needed -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const select = document.getElementById('countryNames');
        if (select) {
            new mdb.Select(select);
        }
    });
</script>
<script>
    /**
     * Dynamically toggles visibility and validation of form fields based on selected product type.
     *
     * - Shows the "Book Details" section only when type is 'book' or 'ebook'.
     * - Enables the "eMedia Link" field only when type is 'ebook'.
     * - Adds/removes 'required' and 'disabled' attributes accordingly.
     */
    const selectedProductType = document.getElementById('productType');
    const bookBlock      = document.getElementById('bookDetailsBlock');
    const emediaBlock    = document.getElementById('emediaBlock');
    const emediaInput    = document.getElementById('productLinkToEmedia');

    if (selectedProductType) {
        const toggleFields = () => {
            const type = selectedProductType.value;

            // show bookDetails fields only for book/ebook
            const showBook = type === 'book' || type === 'ebook';
            bookBlock.classList.toggle('d-none', !showBook);
            bookBlock.querySelectorAll('input')
                .forEach(i => {
                    i.disabled = !showBook;
                    i.required = showBook;
                });

            // show e-Media Link only for ebook
            const showEbookOnly = type === 'ebook';
            emediaBlock.classList.toggle('d-none', !showEbookOnly);
            emediaInput.disabled = !showEbookOnly;
            if (showEbookOnly) {
                emediaInput.setAttribute('required','required');
            } else {
                emediaInput.removeAttribute('required');
                emediaInput.value = '';
            }
        };

        selectedProductType.addEventListener('change', toggleFields);
        toggleFields();
    }
</script>
<script>
    const listItems = document.querySelectorAll("#country_list li");
    document.getElementById("searchInput").addEventListener("input", function () {
        const filter = this.value.toLowerCase();
        let lastVisibleItem = null;

        listItems.forEach(function (item) {
            const label = item.querySelector("label");
            const text = label.textContent.toLowerCase();

            if (text.includes(filter)) {
                item.style.display = "list-item"
                lastVisibleItem = item;
            } else {
                item.style.display = "none";
            }
        });

        listItems.forEach(function (item) {
            if (item.style.display === "list-item") {
                item.style.borderBottom = "1px solid #ddd";
            }
        });

        if (lastVisibleItem) {
            lastVisibleItem.style.borderBottom = "none";
        }

    });
</script>
</body>
</html>
